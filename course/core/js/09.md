# 第 9 章 代理与反射

## 代理基础

:::code 代理基础

ECMAScript 6 新增的代理和反射为开发者提供了拦截并向基本操作嵌入额外行为的能力。
具体地说，可以给目标对象定义一个关联的代理对象，而这个代理对象可以作为抽象的目标对象来使用。
在对目标对象的各种操作影响目标对象之前，可以在代理对象中对这些操作加以控制。

:::

:::code 创建空代理
代理是使用 Proxy 构造函数创建的。这个构造函数接收两个参数：目标对象和处理程序对象。缺少其中任何一个参数都会抛出 TypeError。
在代理对象上执行的所有操作都会无障碍地传播到目标对象。
要创建空代理，可以传一个简单的对象字面量作为处理程序对象，从而让所有操作畅通无阻地抵达目标对象。

```js
const target = {
  id: "target",
  name: "test",
  obj: {
    objId: "1",
    objName: "objTest"
  }
};
const handler = {};
const proxy = new Proxy(target, handler);
// 严格相等可以用来区分代理和目标
console.log(target === proxy); // false
console.log(target); // {id: "target", name: "test", obj: { objId: "1",objName: "objTest"}}
console.log(handler); //{}
console.log(proxy); //Proxy {id: "target", name: "test", obj: { objId: "1",objName: "objTest"}}
console.log(target.obj === proxy.obj); // true
console.log(target.name === proxy.name); // true
console.log(target.id === proxy.id); // true
// id 属性会访问同一个值
console.log(target.id); // target
console.log(proxy.id); // target
// 给目标属性赋值会反映在两个对象上
// 因为两个对象访问的是同一个值
target.id = "foo";
console.log(target.id); // foo
console.log(proxy.id); // foo
// 给代理属性赋值会反映在两个对象上
// 因为这个赋值会转移到目标对象
proxy.id = "bar";
console.log(target.id); // bar
console.log(proxy.id); // bar
// hasOwnProperty()方法在两个地方
// 都会应用到目标对象
console.log(target.hasOwnProperty("id")); // true
console.log(proxy.hasOwnProperty("id")); // true
console.log(typeof target); //object
console.log(typeof proxy); //object
// Proxy.prototype 是 undefined
// 因此不能使用 instanceof 操作符
// console.log(target instanceof Proxy);
// TypeError: Function has non-object prototype 'undefined' in instanceof check
// console.log(proxy instanceof Proxy);
// TypeError: Function has non-object prototype 'undefined' in instanceof check
```

:::

:::code 定义捕获器

```js
```

:::

:::code 捕获器参数和反射 API

```js
```

:::

:::

:::code 捕获器不变式

```js
```

:::

:::code 可撤销代理

```js
```

:::

:::

:::code 实用反射 API

```js
```

:::

:::code 代理另一个代理

```js
```

:::

:::

:::code 代理的问题与不足

```js
```

:::

## 代理捕获器与反射方法

:::code 代理捕获器与反射方法

```js
```

:::


:::code get()

```js
```

:::

:::

:::code set()

```js
```

:::

:::code has()代码

```js
```

:::

:::

:::code defineProperty()

```js
```

:::

:::code getOwnPropertyDescriptor()

```js
```

:::

:::

:::code deleteProperty()

```js
```

:::

:::code ownKeys()

```js
```

:::

:::

:::code getPrototypeOf()

```js
```

:::

:::code setPrototypeOf()

```js
```

:::

:::code isExtensible()

```js
```

:::

:::code preventExtensions()

```js
```

:::

:::code apply()

```js
```

:::

:::code construct()

```js
```

:::

## 代理模式

:::code 跟踪属性访问

```js
```

:::

:::code 隐藏属性

```js
```

:::

:::code 属性验证

```js
```

:::

:::code 函数与构造函数参数验证

```js
```

:::

:::code 数据绑定与可观察对象

```js
```

:::
